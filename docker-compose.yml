version: '3.8'

services:
  # PostgreSQL 数据库 + pgvector 扩展
  postgres:
    image: pgvector/pgvector:pg16
    container_name: miniclaw-learn-postgres
    environment:
      # 数据库用户名
      POSTGRES_USER: miniclaw
      # 数据库密码（生产环境请使用强密码）
      POSTGRES_PASSWORD: miniclaw123
      # 数据库名称
      POSTGRES_DB: miniclaw
    ports:
      # 映射到宿主机端口
      - "5432:5432"
    volumes:
      # 数据持久化
      - postgres_data:/var/lib/postgresql/data
      # 初始化脚本（创建 pgvector 扩展）
      - ./docker/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    healthcheck:
      # 健康检查：确保数据库已启动
      test: ["CMD-SHELL", "pg_isready -U miniclaw -d miniclaw"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

volumes:
  # 数据卷：持久化数据库数据
  postgres_data:
    driver: local
